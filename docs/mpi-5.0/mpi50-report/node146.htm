<!DOCTYPE html>
<html lang=en>
<head>
<!-- This file was generated by tohtml from chap-coll/coll-rendered -->
<!-- with the command
tohtml -default -numbers -dosnl -htables -quietlatex -allgif -endpage mpi5-forum-tail.htm -Wnoredef --mpidoc --latexpgm pdflatex --indexfile mpi50-report-html.idx --lstlisting -basedef mpi5defs.txt -o mpi50-report.tex mpi-reporthtml.tex 
-->
<title>Example using <font face="sans-serif"> MPI_SCAN</font></title>
</head>
<body style="background-color:#FFFFFF">
<hr><h2><span id="Node146">7.11.3. Example using  MPI_SCAN</span></h2>
<a href="node145.htm#Node145"><img width=16 height=16 src="previous.gif" alt="Previous"></a><a href="node143.htm#Node143"><img width=16 height=16 src="up.gif" alt="Up"></a><a href="node147.htm#Node147"><img width=16 height=16 src="next.gif" alt="Next"></a><br>
<b>Up: </b><a href="node143.htm#Node143"> Scan</a>
<b>Next: </b><a href="node147.htm#Node147"> Nonblocking Collective Operations</a>
<b>Previous: </b><a href="node145.htm#Node145"> Exclusive Scan</a>
<p>
  
<P> 
The example in this section uses an intra-communicator.  
<P> 
<br><b> Example</b>  
  
This example uses a user-defined operation to produce a <b> segmented  
scan</b>.  
A segmented scan takes, as input, a set of values and a set of logicals,  
and the logicals delineate the various segments of the scan.  
For example:  
<P><img width=650 height=76 src="img29.gif" alt="Image file"><P>
<P> 
The operator that produces this effect is  
<P> 
<P><img width=258 height=62 src="img30.gif" alt="Image file"><P>
<P> 
where  
<P> 
<P><img width=237 height=62 src="img31.gif" alt="Image file"><P>
<P> 
Note that this is a noncommutative operator.  
C code that implements it is given below.  
<P> 
<br> 
<pre style="background-color:#EFEFEF"><tt><b>typedef</b> <b>struct</b> { 
    <b>double</b> val; 
    <b>int</b> log; 
} SegScanPair; 
 
/* the user-defined function 
 */ 
<b>void</b> segScan(SegScanPair *in, SegScanPair *inout, <b>int</b> *len, 
             <b>MPI_Datatype</b> *dptr) 
{ 
    <b>int</b> i; 
    SegScanPair c; 
 
    <b>for</b> (i=0; i&lt; *len; ++i) { 
        <b>if</b> (in-&gt;log == inout-&gt;log) 
            c.val = in-&gt;val + inout-&gt;val; 
        <b>else</b> 
            c.val = inout-&gt;val; 
        c.log = inout-&gt;log; 
        *inout = c; 
        in++; inout++; 
    } 
} 
</tt></pre> 
  
<P> 
Note that the <font face="sans-serif"> inout</font> argument to the user-defined function  
corresponds to the right-hand operand of the operator.  When using  
this operator, we must be careful to specify that it is noncommutative, as in the following.  
<br> 
<pre style="background-color:#EFEFEF"><tt><b>int</b> i,base; 
SegScanPair  a, answer; 
<b>MPI_Op</b>       myOp; 
<b>MPI_Datatype</b> type[2] = {<b>MPI_DOUBLE</b>, <b>MPI_INT</b>}; 
<b>MPI_Aint</b>     disp[2]; 
<b>int</b>          blocklen[2] = {1, 1}; 
<b>MPI_Datatype</b> sspair; 
 
/* explain to MPI how type SegScanPair is defined 
 */ 
<b>MPI_Get_address</b>(&amp;a, disp); 
<b>MPI_Get_address</b>(&amp;a.log, disp+1); 
base = disp[0]; 
<b>for</b> (i=0; i&lt;2; ++i) disp[i] -= base; 
<b>MPI_Type_create_struct</b>(2, blocklen, disp, type, &amp;sspair); 
<b>MPI_Type_commit</b>(&amp;sspair); 
/* create the segmented-scan user-op 
 */ 
<b>MPI_Op_create</b>(segScan, 0, &amp;myOp); 
... 
<b>MPI_Scan</b>(&amp;a, &amp;answer, 1, sspair, myOp, comm); 
</tt></pre> 
  
<P> 
  
<P> 

<P>
<hr>
<a href="node145.htm#Node145"><img width=16 height=16 src="previous.gif" alt="Previous"></a><a href="node143.htm#Node143"><img width=16 height=16 src="up.gif" alt="Up"></a><a href="node147.htm#Node147"><img width=16 height=16 src="next.gif" alt="Next"></a><br>
<b>Up: </b><a href="node143.htm#Node143"> Scan</a>
<b>Next: </b><a href="node147.htm#Node147"> Nonblocking Collective Operations</a>
<b>Previous: </b><a href="node145.htm#Node145"> Exclusive Scan</a>
<p>
<HR>
Return to <A HREF="node627.htm">MPI-5.0 Standard Index</A><BR>
Return to <A HREF="http://www.mpi-forum.org/index.html">MPI Forum Home Page</A><BR>
<HR>
<FONT SIZE=-1>(Unofficial) MPI-5.0 of June 9, 2025<BR>
HTML Generated on March 2, 2025
</FONT>
</body>
</html>
